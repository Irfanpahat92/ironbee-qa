# -*- coding: utf-8 -*-
#############################################################################
##                                                                         ##
## Licensed to Qualys, Inc. (QUALYS) under one or more                     ##
## contributor license agreements.  See the NOTICE file distributed with   ##
## this work for additional information regarding copyright ownership.     ##
## QUALYS licenses this file to You under the Apache License, Version 2.0  ##
## (the "License"); you may not use this file except in compliance with    ##
## the License.  You may obtain a copy of the License at                   ##
##                                                                         ##
##     http://www.apache.org/licenses/LICENSE-2.0                          ##  
##                                                                         ##
## Unless required by applicable law or agreed to in writing, software     ##
## distributed under the License is distributed on an "AS IS" BASIS,       ##
## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.##
## See the License for the specific language governing permissions and     ##
## limitations under the License.                                          ##
#############################################################################
import random

class IronBeeEvasions:
    def __init__(self):
        self.uni_NFKC = {u'!': [u'\u203c', u'\u2049', u'\ufe15', u'\ufe57', u'\uff01'], u' ': [u'\xa0', u'\xa8', u'\xaf', u'\xb4', u'\xb8', u'\u02d8', u'\u02d9', u'\u02da', u'\u02db', u'\u02dc', u'\u02dd', u'\u037a', u'\u0384', u'\u1fbd', u'\u1fbf', u'\u1fc0', u'\u1ffd', u'\u1ffe', u'\u2000', u'\u2001', u'\u2002', u'\u2003', u'\u2004', u'\u2005', u'\u2006', u'\u2007', u'\u2008', u'\u2009', u'\u200a', u'\u2017', u'\u202f', u'\u203e', u'\u205f', u'\u3000', u'\u309b', u'\u309c', u'\ufc5e', u'\ufc5f', u'\ufc60', u'\ufc61', u'\ufc62', u'\ufc63', u'\ufe49', u'\ufe4a', u'\ufe4b', u'\ufe4c', u'\ufe70', u'\ufe72', u'\ufe74', u'\ufe76', u'\ufe78', u'\ufe7a', u'\ufe7c', u'\ufe7e', u'\uffe3'], u'"': [u'\uff02'], u'%': [u'\ufe6a', u'\uff05'], u'$': [u'\ufe69', u'\uff04'], u"'": [u'\uff07'], u'+': [u'\u207a', u'\u208a', u'\ufb29', u'\ufe62', u'\uff0b'], u'/': [u'\uff0f'], u'.': [u'\u2024', u'\u2025', u'\u2026', u'\ufe19', u'\ufe30', u'\ufe52', u'\uff0e'], u'1': [u'\xb9', u'\xbc', u'\xbd', u'\u2081', u'\u2150', u'\u2151', u'\u2152', u'\u2153', u'\u2155', u'\u2159', u'\u215b', u'\u215f', u'\u2460', u'\u2469', u'\u246a', u'\u246b', u'\u246c', u'\u246d', u'\u246e', u'\u246f', u'\u2470', u'\u2471', u'\u2472', u'\u2488', u'\u2491', u'\u2492', u'\u2493', u'\u2494', u'\u2495', u'\u2496', u'\u2497', u'\u2498', u'\u2499', u'\u249a', u'\u32c0', u'\u32c9', u'\u32ca', u'\u32cb', u'\u3359', u'\u3362', u'\u3363', u'\u3364', u'\u3365', u'\u3366', u'\u3367', u'\u3368', u'\u3369', u'\u336a', u'\u336b', u'\u33e0', u'\u33e9', u'\u33ea', u'\u33eb', u'\u33ec', u'\u33ed', u'\u33ee', u'\u33ef', u'\u33f0', u'\u33f1', u'\u33f2', u'\uff11'], u'0': [u'\u2070', u'\u2080', u'\u2189', u'\u24ea', u'\u3358', u'\uff10'], u'3': [u'\xb3', u'\xbe', u'\u2083', u'\u2157', u'\u215c', u'\u2462', u'\u248a', u'\u325a', u'\u325b', u'\u325c', u'\u325d', u'\u325e', u'\u325f', u'\u32b1', u'\u32b2', u'\u32b3', u'\u32b4', u'\u32c2', u'\u335b', u'\u33e2', u'\u33fd', u'\u33fe', u'\uff13'], u'2': [u'\xb2', u'\u2082', u'\u2154', u'\u2156', u'\u2461', u'\u2473', u'\u2489', u'\u249b', u'\u3251', u'\u3252', u'\u3253', u'\u3254', u'\u3255', u'\u3256', u'\u3257', u'\u3258', u'\u3259', u'\u32c1', u'\u335a', u'\u336c', u'\u336d', u'\u336e', u'\u336f', u'\u3370', u'\u33e1', u'\u33f3', u'\u33f4', u'\u33f5', u'\u33f6', u'\u33f7', u'\u33f8', u'\u33f9', u'\u33fa', u'\u33fb', u'\u33fc', u'\uff12'], u'5': [u'\u2075', u'\u2085', u'\u215a', u'\u215d', u'\u2464', u'\u248c', u'\u32bf', u'\u32c4', u'\u335d', u'\u33e4', u'\uff15'], u'4': [u'\u2074', u'\u2084', u'\u2158', u'\u2463', u'\u248b', u'\u32b5', u'\u32b6', u'\u32b7', u'\u32b8', u'\u32b9', u'\u32ba', u'\u32bb', u'\u32bc', u'\u32bd', u'\u32be', u'\u32c3', u'\u335c', u'\u33e3', u'\uff14'], u'7': [u'\u2077', u'\u2087', u'\u215e', u'\u2466', u'\u248e', u'\u32c6', u'\u335f', u'\u33e6', u'\uff17'], u'6': [u'\u2076', u'\u2086', u'\u2465', u'\u248d', u'\u32c5', u'\u335e', u'\u33e5', u'\uff16'], u'9': [u'\u2079', u'\u2089', u'\u2468', u'\u2490', u'\u32c8', u'\u3361', u'\u33e8', u'\uff19'], u'8': [u'\u2078', u'\u2088', u'\u2467', u'\u248f', u'\u32c7', u'\u3360', u'\u33e7', u'\uff18'], u';': [u'\u037e', u'\ufe14', u'\ufe54', u'\uff1b'], u':': [u'\u2a74', u'\ufe13', u'\ufe55', u'\uff1a'], u'=': [u'\u207c', u'\u208c', u'\u2a75', u'\u2a76', u'\ufe66', u'\uff1d'], u'<': [u'\ufe64', u'\uff1c'], u'>': [u'\ufe65', u'\uff1e'], u'A': [u'\u1d2c', u'\u24b6', u'\u3373', u'\u33df', u'\uff21'], u'@': [u'\ufe6b', u'\uff20'], u'C': [u'\u2102', u'\u212d', u'\u216d', u'\u24b8', u'\u33c6', u'\u33c7', u'\uff23'], u'B': [u'\u1d2e', u'\u212c', u'\u24b7', u'\u33c3', u'\uff22'], u'E': [u'\u1d31', u'\u2130', u'\u24ba', u'\uff25'], u'D': [u'\u01c4', u'\u01c5', u'\u01f1', u'\u01f2', u'\u1d30', u'\u2145', u'\u216e', u'\u24b9', u'\uff24'], u'G': [u'\u1d33', u'\u24bc', u'\u3387', u'\u3393', u'\u33ac', u'\u33c9', u'\uff27'], u'F': [u'\u2131', u'\u213b', u'\u24bb', u'\uff26'], u'I': [u'\u0132', u'\u1d35', u'\u2110', u'\u2111', u'\u2160', u'\u2161', u'\u2162', u'\u2163', u'\u2168', u'\u24be', u'\u337a', u'\uff29'], u'H': [u'\u1d34', u'\u210b', u'\u210c', u'\u210d', u'\u24bd', u'\u32cc', u'\u3390', u'\u33cb', u'\uff28'], u'K': [u'\u1d37', u'\u212a', u'\u24c0', u'\u3385', u'\u33cd', u'\u33ce', u'\uff2b'], u'J': [u'\u1d36', u'\u24bf', u'\uff2a'], u'M': [u'\u1d39', u'\u2133', u'\u216f', u'\u24c2', u'\u3386', u'\u3392', u'\u33ab', u'\u33b9', u'\u33bf', u'\u33c1', u'\uff2d'], u'L': [u'\u013f', u'\u01c7', u'\u01c8', u'\u1d38', u'\u2112', u'\u216c', u'\u24c1', u'\u32cf', u'\uff2c'], u'O': [u'\u1d3c', u'\u24c4', u'\uff2f'], u'N': [u'\u01ca', u'\u01cb', u'\u1d3a', u'\u2115', u'\u2116', u'\u24c3', u'\uff2e'], u'Q': [u'\u211a', u'\u24c6', u'\uff31'], u'P': [u'\u1d3e', u'\u2119', u'\u24c5', u'\u3250', u'\u33a9', u'\u33d7', u'\u33d9', u'\u33da', u'\uff30'], u'S': [u'\u2120', u'\u24c8', u'\u33dc', u'\uff33'], u'R': [u'\u1d3f', u'\u20a8', u'\u211b', u'\u211c', u'\u211d', u'\u24c7', u'\uff32'], u'U': [u'\u1d41', u'\u24ca', u'\uff35'], u'T': [u'\u1d40', u'\u2121', u'\u2122', u'\u24c9', u'\u3394', u'\uff34'], u'W': [u'\u1d42', u'\u24cc', u'\u33dd', u'\uff37'], u'V': [u'\u2164', u'\u2165', u'\u2166', u'\u2167', u'\u24cb', u'\u2c7d', u'\u33de', u'\uff36'], u'Y': [u'\u24ce', u'\uff39'], u'X': [u'\u2169', u'\u216a', u'\u216b', u'\u24cd', u'\uff38'], u'Z': [u'\u2124', u'\u2128', u'\u24cf', u'\uff3a'], u'a': [u'\xaa', u'\u1d43', u'\u1e9a', u'\u2090', u'\u2100', u'\u2101', u'\u24d0', u'\u33c2', u'\uff41'], u'c': [u'\u1d9c', u'\u2105', u'\u2106', u'\u217d', u'\u24d2', u'\u3388', u'\u339d', u'\u33a0', u'\u33a4', u'\u33c4', u'\u33c5', u'\uff43'], u'b': [u'\u1d47', u'\u24d1', u'\u3374', u'\uff42'], u'e': [u'\u1d49', u'\u2091', u'\u212f', u'\u2147', u'\u24d4', u'\u32cd', u'\u32ce', u'\uff45'], u'd': [u'\u01c6', u'\u01f3', u'\u1d48', u'\u2146', u'\u217e', u'\u24d3', u'\u3372', u'\u3377', u'\u3378', u'\u3379', u'\u3397', u'\u33c8', u'\uff44'], u'g': [u'\u1d4d', u'\u210a', u'\u24d6', u'\u33ff', u'\uff47'], u'f': [u'\u1da0', u'\u24d5', u'\u3399', u'\ufb00', u'\ufb01', u'\ufb02', u'\ufb03', u'\ufb04', u'\uff46'], u'i': [u'\u0133', u'\u1d62', u'\u2071', u'\u2139', u'\u2148', u'\u2170', u'\u2171', u'\u2172', u'\u2173', u'\u2178', u'\u24d8', u'\u33cc', u'\uff49'], u'h': [u'\u02b0', u'\u2095', u'\u210e', u'\u24d7', u'\u3371', u'\u33ca', u'\uff48'], u'k': [u'\u1d4f', u'\u2096', u'\u24da', u'\u3384', u'\u3389', u'\u338f', u'\u3391', u'\u3398', u'\u339e', u'\u33a2', u'\u33a6', u'\u33aa', u'\u33b8', u'\u33be', u'\u33c0', u'\u33cf', u'\uff4b'], u'j': [u'\u02b2', u'\u2149', u'\u24d9', u'\u2c7c', u'\uff4a'], u'm': [u'\u1d50', u'\u2098', u'\u217f', u'\u24dc', u'\u3383', u'\u338e', u'\u3396', u'\u339c', u'\u339f', u'\u33a1', u'\u33a3', u'\u33a5', u'\u33a7', u'\u33a8', u'\u33b3', u'\u33b7', u'\u33bd', u'\u33d4', u'\u33d5', u'\u33d6', u'\uff4d'], u'l': [u'\u0140', u'\u01c9', u'\u02e1', u'\u2097', u'\u2113', u'\u217c', u'\u24db', u'\u33d0', u'\u33d1', u'\u33d2', u'\u33d3', u'\uff4c'], u'o': [u'\xba', u'\u1d52', u'\u2092', u'\u2134', u'\u24de', u'\u3375', u'\uff4f'], u'n': [u'\u01cc', u'\u207f', u'\u2099', u'\u24dd', u'\u3381', u'\u338b', u'\u339a', u'\u33b1', u'\u33b5', u'\u33bb', u'\uff4e'], u'q': [u'\u24e0', u'\uff51'], u'p': [u'\u1d56', u'\u209a', u'\u24df', u'\u3376', u'\u3380', u'\u338a', u'\u33b0', u'\u33b4', u'\u33ba', u'\u33d8', u'\uff50'], u's': [u'\u017f', u'\u02e2', u'\u209b', u'\u24e2', u'\u33db', u'\ufb05', u'\ufb06', u'\uff53'], u'r': [u'\u02b3', u'\u1d63', u'\u24e1', u'\u33ad', u'\u33ae', u'\u33af', u'\uff52'], u'u': [u'\u1d58', u'\u1d64', u'\u24e4', u'\uff55'], u't': [u'\u1d57', u'\u209c', u'\u24e3', u'\uff54'], u'w': [u'\u02b7', u'\u24e6', u'\uff57'], u'v': [u'\u1d5b', u'\u1d65', u'\u2174', u'\u2175', u'\u2176', u'\u2177', u'\u24e5', u'\uff56'], u'y': [u'\u02b8', u'\u24e8', u'\uff59'], u'x': [u'\u02e3', u'\u2093', u'\u2179', u'\u217a', u'\u217b', u'\u24e7', u'\uff58'], u'{': [u'\ufe37', u'\ufe5b', u'\uff5b'], u'z': [u'\u1dbb', u'\u24e9', u'\uff5a'], u'}': [u'\ufe38', u'\ufe5c', u'\uff5d']}

        self.uni_NFKD = {u'!': [u'\ufe15', u'\ufe57', u'\uff01'], u' ': [u'\xa0', u'\u2000', u'\u2001', u'\u2002', u'\u2003', u'\u2004', u'\u2005', u'\u2006', u'\u2007', u'\u2008', u'\u2009', u'\u200a', u'\u202f', u'\u205f', u'\u3000'], u'"': [u'\uff02'], u'%': [u'\ufe6a', u'\uff05'], u'$': [u'\ufe69', u'\uff04'], u"'": [u'\uff07'], u'+': [u'\u207a', u'\u208a', u'\ufb29', u'\ufe62', u'\uff0b'], u'/': [u'\uff0f'], u'.': [u'\u2024', u'\ufe52', u'\uff0e'], u'1': [u'\xb9', u'\u2081', u'\u2460', u'\uff11'], u'0': [u'\u2070', u'\u2080', u'\u24ea', u'\uff10'], u'3': [u'\xb3', u'\u2083', u'\u2462', u'\uff13'], u'2': [u'\xb2', u'\u2082', u'\u2461', u'\uff12'], u'5': [u'\u2075', u'\u2085', u'\u2464', u'\uff15'], u'4': [u'\u2074', u'\u2084', u'\u2463', u'\uff14'], u'7': [u'\u2077', u'\u2087', u'\u2466', u'\uff17'], u'6': [u'\u2076', u'\u2086', u'\u2465', u'\uff16'], u'9': [u'\u2079', u'\u2089', u'\u2468', u'\uff19'], u'8': [u'\u2078', u'\u2088', u'\u2467', u'\uff18'], u';': [u'\u037e', u'\ufe14', u'\ufe54', u'\uff1b'], u':': [u'\ufe13', u'\ufe55', u'\uff1a'], u'=': [u'\u207c', u'\u208c', u'\ufe66', u'\uff1d'], u'<': [u'\ufe64', u'\uff1c'], u'>': [u'\ufe65', u'\uff1e'], u'A': [u'\u1d2c', u'\u24b6', u'\uff21'], u'@': [u'\ufe6b', u'\uff20'], u'C': [u'\u2102', u'\u212d', u'\u216d', u'\u24b8', u'\uff23'], u'B': [u'\u1d2e', u'\u212c', u'\u24b7', u'\uff22'], u'E': [u'\u1d31', u'\u2130', u'\u24ba', u'\uff25'], u'D': [u'\u1d30', u'\u2145', u'\u216e', u'\u24b9', u'\uff24'], u'G': [u'\u1d33', u'\u24bc', u'\uff27'], u'F': [u'\u2131', u'\u24bb', u'\uff26'], u'I': [u'\u1d35', u'\u2110', u'\u2111', u'\u2160', u'\u24be', u'\uff29'], u'H': [u'\u1d34', u'\u210b', u'\u210c', u'\u210d', u'\u24bd', u'\uff28'], u'K': [u'\u1d37', u'\u212a', u'\u24c0', u'\uff2b'], u'J': [u'\u1d36', u'\u24bf', u'\uff2a'], u'M': [u'\u1d39', u'\u2133', u'\u216f', u'\u24c2', u'\uff2d'], u'L': [u'\u1d38', u'\u2112', u'\u216c', u'\u24c1', u'\uff2c'], u'O': [u'\u1d3c', u'\u24c4', u'\uff2f'], u'N': [u'\u1d3a', u'\u2115', u'\u24c3', u'\uff2e'], u'Q': [u'\u211a', u'\u24c6', u'\uff31'], u'P': [u'\u1d3e', u'\u2119', u'\u24c5', u'\uff30'], u'S': [u'\u24c8', u'\uff33'], u'R': [u'\u1d3f', u'\u211b', u'\u211c', u'\u211d', u'\u24c7', u'\uff32'], u'U': [u'\u1d41', u'\u24ca', u'\uff35'], u'T': [u'\u1d40', u'\u24c9', u'\uff34'], u'W': [u'\u1d42', u'\u24cc', u'\uff37'], u'V': [u'\u2164', u'\u24cb', u'\u2c7d', u'\uff36'], u'Y': [u'\u24ce', u'\uff39'], u'X': [u'\u2169', u'\u24cd', u'\uff38'], u'Z': [u'\u2124', u'\u2128', u'\u24cf', u'\uff3a'], u'a': [u'\xaa', u'\u1d43', u'\u2090', u'\u24d0', u'\uff41'], u'c': [u'\u1d9c', u'\u217d', u'\u24d2', u'\uff43'], u'b': [u'\u1d47', u'\u24d1', u'\uff42'], u'e': [u'\u1d49', u'\u2091', u'\u212f', u'\u2147', u'\u24d4', u'\uff45'], u'd': [u'\u1d48', u'\u2146', u'\u217e', u'\u24d3', u'\uff44'], u'g': [u'\u1d4d', u'\u210a', u'\u24d6', u'\uff47'], u'f': [u'\u1da0', u'\u24d5', u'\uff46'], u'i': [u'\u1d62', u'\u2071', u'\u2139', u'\u2148', u'\u2170', u'\u24d8', u'\uff49'], u'h': [u'\u02b0', u'\u2095', u'\u210e', u'\u24d7', u'\uff48'], u'k': [u'\u1d4f', u'\u2096', u'\u24da', u'\uff4b'], u'j': [u'\u02b2', u'\u2149', u'\u24d9', u'\u2c7c', u'\uff4a'], u'm': [u'\u1d50', u'\u2098', u'\u217f', u'\u24dc', u'\uff4d'], u'l': [u'\u02e1', u'\u2097', u'\u2113', u'\u217c', u'\u24db', u'\uff4c'], u'o': [u'\xba', u'\u1d52', u'\u2092', u'\u2134', u'\u24de', u'\uff4f'], u'n': [u'\u207f', u'\u2099', u'\u24dd', u'\uff4e'], u'q': [u'\u24e0', u'\uff51'], u'p': [u'\u1d56', u'\u209a', u'\u24df', u'\uff50'], u's': [u'\u017f', u'\u02e2', u'\u209b', u'\u24e2', u'\uff53'], u'r': [u'\u02b3', u'\u1d63', u'\u24e1', u'\uff52'], u'u': [u'\u1d58', u'\u1d64', u'\u24e4', u'\uff55'], u't': [u'\u1d57', u'\u209c', u'\u24e3', u'\uff54'], u'w': [u'\u02b7', u'\u24e6', u'\uff57'], u'v': [u'\u1d5b', u'\u1d65', u'\u2174', u'\u24e5', u'\uff56'], u'y': [u'\u02b8', u'\u24e8', u'\uff59'], u'x': [u'\u02e3', u'\u2093', u'\u2179', u'\u24e7', u'\uff58'], u'{': [u'\ufe37', u'\ufe5b', u'\uff5b'], u'z': [u'\u1dbb', u'\u24e9', u'\uff5a'], u'}': [u'\ufe38', u'\ufe5c', u'\uff5d']}

    def nfkc_sub(self,string):
        string_array = list(string)
        new_string_array = []
        for value in string_array:
            if self.uni_NFKC.has_key(value):
                new_string_array.append(random.choice(self.uni_NFKC[value]))
            else:
                new_string_array.append(value)

        return u''.join(new_string_array)

    def nfkd_sub(self,string):
        string_array = list(string)
        new_string_array = []
        for value in string_array:
            if self.uni_NFKD.has_key(value):
                new_string_array.append(random.choice(self.uni_NFKD[value]))
            else:
                new_string_array.append(value)

        return u''.join(new_string_array)
